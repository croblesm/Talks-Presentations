# K8's deployment for SQL Server
# --------------------------------------

# Start minikube
[dba mastery] ~ $  minikube start
ğŸ˜„  minikube v1.0.0 on darwin (amd64)
ğŸ¤¹  Downloading Kubernetes v1.14.0 images in the background ...
ğŸ’¡  Tip: Use 'minikube start -p <name>' to create a new cluster, or 'minikube delete' to delete this one.
ğŸ”„  Restarting existing virtualbox VM for "minikube" ...
âŒ›  Waiting for SSH access ...
ğŸ“¶  "minikube" IP address is 192.168.99.100
ğŸ³  Configuring Docker as the container runtime ...
ğŸ³  Version of container runtime is 17.12.1-ce
âŒ›  Waiting for image downloads to complete ...
âœ¨  Preparing Kubernetes environment ...
ğŸšœ  Pulling images required by Kubernetes v1.14.0 ...
ğŸ”„  Relaunching Kubernetes v1.14.0 using kubeadm ... 
âŒ›  Waiting for pods: apiserver proxy etcd scheduler controller dns
ğŸ“¯  Updating kube-proxy configuration ...
ğŸ¤”  Verifying component health ......
ğŸ’—  kubectl is now configured to use "minikube"
ğŸ„  Done! Thank you for using minikube!

# Create SQL Server namespace
[dba mastery] ~ $  kubectl create namespace sql-kubernetes
namespace/sql-kubernetes created

# Create secret
kubectl create secret generic mssql --from-literal=SA_PASSWORD="20Ye4rsOfP@ss#"
secret/mssql created

# Create PersistentVolumeClaim yaml file for SQL Server deployment
vi pvc_sql-kubernetes.yaml
    kind: PersistentVolumeClaim
    apiVersion: v1
    metadata:
    name: mssql-data-claim
    spec:
    accessModes:
    - ReadWriteOnce
    resources:
    requests:
        storage: 10Gi

# Apply PersistentVolumeClaim yaml file for SQL Server deployment
[dba mastery] ~ $  kubectl apply -f pvc_sql-kubernetes.yaml
persistentvolumeclaim/mssql-data-claim created

# Deploy service 
vi sql-kubernetes.yaml
[dba mastery] ~ $  kubectl apply -f sql-kubernetes.yaml
service/mssql-deployment created

# Get K8s information
kubectl get pods
kubectl get services
minikube service mssql-deployment --url

# Open ADS and connect
sqlcmd -S 192.168.99.100,32673 -U SA -P "20Ye4rsOfP@ss#"